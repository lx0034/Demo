function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}Backbone.LocalStorage=window.Store=function(e){this.name=e;var t=this.localStorage().getItem(this.name);this.records=t&&t.split(",")||[]},_.extend(Backbone.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||(e.id=guid(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.records.push(e.id.toString()),this.save(),this.find(e)},update:function(e){return this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),_.include(this.records,e.id.toString())||this.records.push(e.id.toString()),this.save(),this.find(e)},find:function(e){return this.jsonData(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){return _(this.records).chain().map(function(e){return this.jsonData(this.localStorage().getItem(this.name+"-"+e))},this).compact().value()},destroy:function(e){return e.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+e.id),this.records=_.reject(this.records,function(t){return t===e.id.toString()}),this.save(),e)},localStorage:function(){return localStorage},jsonData:function(e){return e&&JSON.parse(e)}}),Backbone.LocalStorage.sync=window.Store.sync=Backbone.localSync=function(e,t,o){var n,r,c=t.localStorage||t.collection.localStorage,a=$.Deferred&&$.Deferred();try{switch(e){case"read":n=void 0!=t.id?c.find(t):c.findAll();break;case"create":n=c.create(t);break;case"update":n=c.update(t);break;case"delete":n=c.destroy(t)}}catch(i){r=i.code===DOMException.QUOTA_EXCEEDED_ERR&&0===window.localStorage.length?"Private browsing is unsupported":i.message}return n?(o&&o.success&&("0.9.10"===Backbone.VERSION?o.success(t,n,o):o.success(n)),a&&a.resolve(n)):(r=r?r:"Record Not Found",o&&o.error&&("0.9.10"===Backbone.VERSION?o.error(t,r,o):o.error(r)),a&&a.reject(r)),o&&o.complete&&o.complete(n),a&&a.promise()},Backbone.ajaxSync=Backbone.sync,Backbone.getSyncMethod=function(e){return e.localStorage||e.collection&&e.collection.localStorage?Backbone.localSync:Backbone.ajaxSync},Backbone.sync=function(e,t,o){return Backbone.getSyncMethod(t).apply(this,[e,t,o])};